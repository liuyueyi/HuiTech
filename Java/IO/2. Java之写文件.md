# 2. Javaä¹‹å†™æ–‡ä»¶

> ä¸Šä¸€ç¯‡å†™äº†javaè¯»å–æ–‡ä»¶çš„å„ç§æ“ä½œå§¿åŠ¿ï¼Œè¿™é‡Œä¹Ÿè¡¥ä¸€ä¸ªå†™æ–‡ä»¶çš„å·¥å…·ç±»ï¼Œæ¯”è¾ƒç®€å•


### 1. è¯»å†™ç±»ä»‹ç» ï¼ˆå’Œä¸Šä¸€ç¯‡å·®ä¸å¤šï¼‰

> javaè¯»å†™æ–‡ä»¶çš„IOæµåˆ†ä¸¤å¤§ç±»ï¼Œå­—èŠ‚æµå’Œå­—ç¬¦æµï¼ŒåŸºç±»åˆ†åˆ«æ˜¯å­—ç¬¦ï¼šReaderå’ŒWriterï¼›å­—èŠ‚ï¼šInputStreamå’ŒOutPutStream

å­—ç¬¦æµåˆ†ä¸ºFileReaderå’ŒFileWrtierï¼Œè¿™ä¸¤ä¸ªçš„çˆ¶ç±»æ˜¯InputStreamReaderå’ŒOutStreamWrtier

å­—èŠ‚æµåˆ†ä¸ºFileInputStreamå’ŒFileOutPutStream


**ç»§æ‰¿å…³ç³»è¡¨**

```
Reader->InputStreamReader->FileReader

Reader->BufferedReader


Writer->OutputStreamWriter->FileWriter

Writer->BufferedWriter



InputStream->FileInputStreamã€‚FileInputStream ç”¨äºè¯»å–è¯¸å¦‚å›¾åƒæ•°æ®ä¹‹ç±»çš„åŸå§‹å­—èŠ‚æµã€‚è¦è¯»å–å­—ç¬¦æµï¼Œè¯·è€ƒè™‘ä½¿ç”¨ FileReaderã€‚

InputStream->FilterInputStream->BufferedInputStream


OutputStream->FileOutputStreamã€‚FileOutputStream ç”¨äºå†™å…¥è¯¸å¦‚å›¾åƒæ•°æ®ä¹‹ç±»çš„åŸå§‹å­—èŠ‚çš„æµã€‚è¦å†™å…¥å­—ç¬¦æµï¼Œè¯·è€ƒè™‘ä½¿ç”¨ FileWriter

OutputStream->FilterOutputStream->BufferedOutputStream
```


ä¸€èˆ¬ä½¿ç”¨æµç¨‹

1. åˆ›å»ºæ–‡ä»¶å¯¹è±¡ `File file = new File("xxx.txt");`
2. ç”¨æµè£…è½½æ–‡ä»¶ `OutputStream fr = new FileOutputStream(file);`
3. å¦‚æœç”¨ç¼“å†²åŒºï¼Œåˆ™ç”¨ç¼“å†²åŒºè£…è½½æµï¼Œç”¨ç¼“å†²åŒºæ˜¯ä¸ºäº†æé«˜è¯»å†™æ€§èƒ½ `BufferedOutputStream br = new BufferedOutputStream(fr);`
4. å†™æ–‡ä»¶:  `br.write(xxx)`

å†™æ–‡ä»¶ï¼Œå¯ä»¥æŒ‰å­—èŠ‚æ–¹å¼å†™å…¥ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§å­—ç¬¦æ–¹å¼å†™å…¥æ–‡ä»¶ï¼Œå†™æ–‡ä»¶ï¼ŒåŒ…æ‹¬æ˜¯å¦æ˜¯è¿½åŠ å†™ï¼Œç¼–ç æ–¹å¼ç­‰

### 2. ç”Ÿæˆç›®å½•
> å†™æ–‡ä»¶ä¹‹å‰, æ–‡ä»¶å¯ä»¥ä¸å­˜åœ¨ï¼Œä½†æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•å¿…é¡»æœ‰ï¼Œæ‰€ä»¥å°±æœ‰ä¸ªç”Ÿæˆç›®å½•çš„æ–¹æ³•äº†


æä¾›äº†ä¸€ä¸ªå·¥å…·ç±» `DirUtil`, å¯ä»¥é€’å½’ç”Ÿæˆ`path`è·¯å¾„å¯¹åº”çš„æ‰€æœ‰ç›®å½•ï¼ˆå‰ææ˜¯æœ‰æƒé™ï¼‰

```java
    /**
     * é€’å½’åˆ›å»ºæ–‡ä»¶å¤¹
     *
     * @param file ç”±ç›®å½•åˆ›å»ºçš„fileå¯¹è±¡
     * @throws FileNotFoundException
     */
    public static void mkDir(File file) throws FileNotFoundException {
        if (file == null) {
            throw new FileNotFoundException();
        }

        if (file.getParentFile().exists()) {
            if (file.exists()) { // ç›®å½•å­˜åœ¨, åˆ™ç›´æ¥è¿”å›
                return;
            }

            if (!file.mkdir()) { // ä¸å­˜åœ¨, åˆ™åˆ›å»º
                throw new FileNotFoundException();
            }
        } else {
            mkDir(file.getParentFile()); // åˆ›å»ºçˆ¶ç›®å½•
            if (!file.exists() && !file.mkdir()) {
                throw new FileNotFoundException();
            }
        }
    }
```

### 3. å†™æ–‡ä»¶

æä¾›äº†ä¸¤ç§å†™æ–‡ä»¶çš„æ–¹å¼ï¼Œå­—èŠ‚æµè¾“å‡ºå’Œå­—ç¬¦æµè¾“å‡ºï¼Œå…¶ä¸­å­—ç¬¦æµè¾“å‡ºæ—¶ï¼Œåˆ¶å®šäº†ç¼–ç æ ¼å¼ä¸º`UTF-8`ï¼Œ è¿™ä¸ªå·¥å…·çš„å®ç°æ–¹å¼ä¸è¯»çš„å·¥å…·ç±»ä¸å¤ªç›¸åŒï¼Œå…ˆçœ‹ä¸‹ä»£ç ç»“æ„

```java
/**
 * å†™æ–‡ä»¶å·¥å…·ç±»
 * <p/>
 * Created by yihui on 2017/5/17.
 */
public class FileWriteUtil {

    public enum WriteType {
        BUFFER,
        WRITER
    }


    private Object output;

    private WriteType currentType;


    public static FileWriteUtil newInstance(WriteType writeType, String filename, boolean isAppend) throws IOException {
        return new FileWriteUtil(writeType, filename, isAppend);
    }


    private FileWriteUtil(WriteType writeType, String filename, boolean isAppend) throws IOException {
        currentType = writeType;

        if (writeType == WriteType.BUFFER) {
            output = new BufferedOutputStream(new FileOutputStream(filename, isAppend));
        } else if (writeType == WriteType.WRITER) {
            output = new OutputStreamWriter(new FileOutputStream(filename, isAppend), Charset.forName("UTF-8"));
        }
    }


    public FileWriteUtil write(String data) throws IOException {
        if (currentType == WriteType.BUFFER) {
            ((BufferedOutputStream) output).write(data.getBytes());
            ((BufferedOutputStream) output).flush();
        } else {
            ((OutputStreamWriter) output).write(data);
            ((OutputStreamWriter) output).flush();
        }

        return this;
    }


    public void close() throws IOException {
        if (currentType == WriteType.BUFFER) {
            ((BufferedOutputStream) output).close();
        } else {
            ((OutputStreamWriter) output).close();
        }
    }
}
```

- è°ƒç”¨æ–¹ï¼Œéœ€è¦é€šè¿‡ `com.hust.hui.quicksilver.file.FileWriteUtil.newInstance(xxx)` æ–¹å¼æ¥è·å–å®ä¾‹å¯¹è±¡ï¼Œç„¶åæŒæœ‰è¿™ä¸ªå¯¹è±¡è¿›è¡Œå†™å…¥æ“ä½œ
- å…¶æ¬¡ `write()` æ–¹æ³•è¿”å›å¯¹è±¡è‡ªå¼•ç”¨ï¼Œ å› æ­¤æ”¯æŒç±»ä¼¼ `builderæ¨¡å¼` çš„è¾“å‡ºæ–¹å¼
- æ¯æ¬¡å®Œæ¯•ä¹‹åï¼Œéœ€è¦æ˜¾ç¤ºè°ƒç”¨å…³é—­æ–¹æ³•


### 3. æµ‹è¯•ç”¨ä¾‹

ä»£ç ç»“æ„æ¯”è¾ƒç®€å•ï¼Œå®ç° + æµ‹è¯•éƒ½æ˜¯ä¸€ç›®äº†ç„¶ï¼Œç›´æ¥è´´å‡ºä»£ç å’Œç»“æœ

```java
@Test
    public void testBufWrite() throws IOException {
        FileWriteUtil fileWrite = FileWriteUtil.newInstance(FileWriteUtil.WriteType.BUFFER, "bufWrite.txt", false);
        try {

            fileWrite.write("hello world")
                    .write("\n")
                    .write("ä½ å¥½ğŸ˜„ã€Š-è¡¨æƒ…ç¬¦ã€‹");

        } finally {
            fileWrite.close();
        }
    }


    @Test
    public void testWriterWrite() throws IOException {
        FileWriteUtil fileWrite = FileWriteUtil.newInstance(FileWriteUtil.WriteType.WRITER, "writerWrite.txt", false);

        try {

            fileWrite.write("hello world")
                    .write("\n")
                    .write("ä½ å¥½ğŸ˜„ã€Š-è¡¨æƒ…ç¬¦ã€‹");

        } finally {
            fileWrite.close();
        }
    }
```

æµ‹è¯•ç”¨ä¾‹æ¼”ç¤º

![æ¼”ç¤ºè¯´æ˜](https://static.oschina.net/uploads/img/201705/17200050_HLlR.gif)


### 4. åšæ–‡ç›¸å…³

æºç ç›´é€šè½¦:  [https://git.oschina.net/liuyueyi/quicksilver/tree/master/silver-file?dir=1&filepath=silver-file](https://git.oschina.net/liuyueyi/quicksilver/tree/master/silver-file?dir=1&filepath=silver-file)

è¯»æ–‡ä»¶é“¾æ¥ï¼š[javaä¹‹çš„è¯»å–æ–‡ä»¶å¤§å…¨](https://my.oschina.net/u/566591/blog/894663)

åå°„ç”Ÿæˆå¯¹è±¡åšæ–‡ï¼š [javaä¹‹é€šè¿‡åå°„ç”Ÿæˆå¹¶åˆå§‹åŒ–å¯¹è±¡](https://my.oschina.net/u/566591/blog/897620)

