# 4. JavaWebä¸‰å¤§ç»„ä»¶ä¹‹Servletå­¦ä¹ 

<!--
create time: 2018-01-24 09:59:25
Author: yihui
-->

> å¹³æ—¶ç›´æ¥ç”¨springmvcè¾ƒå¤šï¼Œéƒ½æ²¡æ€ä¹ˆæ¥è§¦åº•å±‚çš„Servletï¼Œå¯¼è‡´å¯¹ä¸€äº›åŸºæœ¬çš„çŸ¥è¯†ç‚¹äº†è§£éƒ½ä¸å¤Ÿï¼Œæ‰€ä»¥ä»Šå¤©ä¸“é—¨çš„æŠ½å‡ºæ—¶é—´æ¥å­¦ä¹ ä¸€ä¸‹

å¸¦ç€é—®é¢˜å‡ºå‘ï¼Œçœ‹ä¸‹å¯ä»¥æ€ä¹ˆç©

- å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªServlet
- è‡ªå®šä¹‰çš„Serlvetå¦‚ä½•å·¥ä½œ
- servletçš„ä¼˜å…ˆé¡ºåºæ€ä¹ˆåˆ¤å®š 
- servletåŒ¹é…æ˜¯æ€æ ·çš„ (url-mapping...ï¼‰
- å¦‚ä½•è·å–å‚æ•°ï¼ˆgetè¯·æ±‚å‚æ•°ï¼Œpostè¯·æ±‚å‚æ•°ï¼Œä¸Šä¼ æ–‡ä»¶ï¼‰
- å¦‚ä½•è¿”å›æ•°æ®ï¼ˆè¿”å›é¡µé¢ï¼Œè¿”å›æ–‡ä»¶ï¼Œè¿”å›äºŒè¿›åˆ¶ï¼‰
- è¯·æ±‚å¤´å’Œè¿”å›å¤´çš„è®¾ç½®

## I. åŸºæœ¬çŸ¥è¯†ç‚¹

### 1. ä»€ä¹ˆæ˜¯Servlet

Servletæ˜¯JavaWebçš„ä¸‰å¤§ç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒå±äºåŠ¨æ€èµ„æºã€‚Servletçš„ä½œç”¨æ˜¯å¤„ç†è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šæŠŠæ¥æ”¶åˆ°çš„è¯·æ±‚äº¤ç»™Servletæ¥å¤„ç†ï¼Œåœ¨Servletä¸­é€šå¸¸éœ€è¦ï¼š

- æ¥å—è¯·æ±‚
- å¤„ç†è¯·æ±‚
- å®Œæˆå“åº”

### 2. æ€ä¹ˆç©Servlet

ä¸€èˆ¬æ¥è®²ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„Servletæœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œåœ¨web.xmlä¸­é…ç½®serverltçš„å£°æ˜ï¼›å®ç°Servletæ¥å£ï¼Œå®ç°è‡ªå®šä¹‰çš„Servleté€»è¾‘

ä¸€ä¸ªç®€å•çš„caseå¦‚ä¸‹

web.xmlä¸­ï¼Œæ·»åŠ é…ç½®

```xml
<servlet>
    <servlet-name>doc-servlet</servlet-name>
    <servlet-class>com.yihui.study.DocServlet</servlet-class>
    <load-on-startup>0</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>doc-servlet</servlet-name>
    <url-pattern>/study/*</url-pattern>
</servlet-mapping>
```

å®ç°è‡ªå®šä¹‰Servlet

```java
public class DocServlet extends HttpServlet {

    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
        resp.setCharacterEncoding("utf-8");
        PrintWriter writer = resp.getWriter();
        writer.append("è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰servlet")
                .append("emojğŸ˜„==").flush();
        System.out.println("hereher!!!!");
    }
}
```

ä¸Šé¢è¿™ä¸ªServletï¼Œå®ç°äº†æ‹¦æˆª /study ä¸‹çš„æ‰€æœ‰è¯·æ±‚ï¼Œ ç„¶åè¿”å›ä¸€æ®µæ–‡æœ¬ï¼Œä¸Šé¢ä½œä¸ºæ¼”ç¤ºï¼Œå…·ä½“çš„å±•å¼€ä¸‹é¢è¯´æ˜

### 3. Servletæ¥å£è¯´æ˜

ä¸Šé¢æ˜¯ç›´æ¥ç»§æ‰¿äº†HttpServletï¼Œå¯èƒ½æ²¡æ³•å®Œå…¨çš„æš´éœ²ä¸€ä¸ªServletçš„å…·ä½“æ¥å£æœ‰å“ªäº›ï¼Œä»¥åŠå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„ï¼Œæ¥ä¸‹æ¥åˆ™ç›´æ¥é’ˆå¯¹æºå¤´è¿›è¡Œè¯´æ˜

```java
public interface Servlet {
    // åˆå§‹åŒ–
    public void init(ServletConfig config) throws ServletException;
    
    // è·å–é…ç½®ä¿¡æ¯
    public ServletConfig getServletConfig();
    
    // å¤„ç†è¯·æ±‚
    public void service(ServletRequest req, ServletResponse res)
	throws ServletException, IOException;
	
	  // Returns information about the servlet, such as author, version, and copyright
    public String getServletInfo();
    
    // é”€æ¯
    public void destroy();
}
```

äº”ä¸ªæ–¹æ³•ï¼Œä»å‘½åä¹Ÿå¯ä»¥çœ‹å‡ºå¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸ

- é¦–å…ˆæ˜¯åˆ›å»ºï¼š init() æ–¹æ³•è¢«åˆ›å»º
- åˆ›å»ºå®Œæ¯•ä¹‹åï¼Œè¯·æ±‚æ¥äº†ï¼Œåˆ†ç»™  serviceæ–¹æ³•ï¼Œæ‰§è¡Œå¯¹åº”çš„ä¸šåŠ¡é€»è¾‘
- æœ€åä¸æƒ³ç©äº†ï¼Œå°±é”€æ¯æ‰ï¼Œæ­¤æ—¶è§¦å‘ destroyæ–¹æ³•


**è¯´æ˜**

åœ¨Servletè¢«åˆ›å»ºåï¼ŒæœåŠ¡å™¨ä¼šé©¬ä¸Šè°ƒç”¨Servletçš„void init(ServletConfig)æ–¹æ³•ã€‚è¯·è®°ä½ï¼Œ Servletå‡ºç”Ÿåé©¬ä¸Šå°±ä¼šè°ƒç”¨init()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›å¯¹Servletçš„åˆå§‹åŒ–å·¥ä½œæ”¾åˆ°initæ–¹æ³•ä¸­ï¼Œä»Šåæ‰€æœ‰åˆ†é…åˆ°è¿™ä¸ªServletçš„è¯·æ±‚ï¼Œéƒ½æ˜¯å…¬ç”¨è¿™ä¸ªServletçš„


### 4. ServletConfig
> init()æ–¹æ³•çš„å‚æ•°

ServletConfigå¯¹è±¡å¯¹åº”web.xmlæ–‡ä»¶ä¸­çš„å…ƒç´ ã€‚ä¾‹å¦‚ä½ æƒ³è·å–å½“å‰Servletåœ¨web.xmlæ–‡ä»¶ä¸­çš„é…ç½®åï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨servletConfig.getServletName()æ–¹æ³•è·å–

```
String getServletName()ï¼šè·å–Servletåœ¨web.xmlæ–‡ä»¶ä¸­çš„é…ç½®åç§°ï¼Œå³æŒ‡å®šçš„åç§°ï¼› 
ServletContext getServletContext()ï¼šç”¨æ¥è·å–ServletContextå¯¹è±¡ï¼ŒServletContextä¼šåœ¨åé¢è®²è§£ï¼› 
String getInitParameter(String name)ï¼šç”¨æ¥è·å–åœ¨web.xmlä¸­é…ç½®çš„åˆå§‹åŒ–å‚æ•°ï¼Œé€šè¿‡å‚æ•°åæ¥è·å–å‚æ•°å€¼ï¼› 
Enumeration getInitParameterNames()ï¼šç”¨æ¥è·å–åœ¨web.xmlä¸­é…ç½®çš„æ‰€æœ‰åˆå§‹åŒ–å‚æ•°åç§°ï¼›
```

### 5. ServletRequest
> è¯·æ±‚å¯¹è±¡ï¼Œå¯ä»¥ä»å…¶ä¸­è·å–è¯·æ±‚æ•°æ®ï¼Œè¯·æ±‚å¤´ç­‰

å†…éƒ¨æä¾›çš„æ–¹æ³•æŒºå¤šï¼Œé€šå¸¸æˆ‘ä»¬æœ€å…³å¿ƒçš„æœ‰:

- è·å–å‚æ•°: `javax.servlet.ServletRequest#getParameter`
- è·å–å¤´ : `javax.servlet.http.HttpServletRequest#getHeader`
- è·å–cookie: `javax.servlet.http.HttpServletRequest#getCookies`
- è·å–è¯·æ±‚ : `javax.servlet.http.HttpServletRequest#getRequestURI`
- ...

è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å°±æ˜¯æŒ‡å®šå­—ç¬¦ç¼–ç ï¼Œå¦‚æˆ‘ä»¬é€šå¸¸è¦æ±‚æäº¤çš„å‚æ•°æ»¡è¶³utf8ç¼–ç ï¼Œè¿™æ—¶å°±å¯ä»¥å¦‚ä¸‹è®¾ç½®

```
// javax.servlet.ServletRequest#setCharacterEncoding
request.setCharacterEncoding("utf-8");
```

å¦‚æˆ‘ä»¬æœ€å¸¸ç”¨çš„ä¸€ä¸ªspringçš„fitlerï¼Œå…³é”®ä»£ç å¦‚ä¸‹

```java
// org.springframework.web.filter.CharacterEncodingFilter#doFilterInternal
// 
@Override
protected void doFilterInternal(
		HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
		throws ServletException, IOException {

	if (this.encoding != null && (this.forceEncoding || request.getCharacterEncoding() == null)) {
		request.setCharacterEncoding(this.encoding);
		if (this.forceEncoding) {
			response.setCharacterEncoding(this.encoding);
		}
	}
	filterChain.doFilter(request, response);
}
```

### 6. ServletResponse
> è¿”å›å¯¹è±¡ï¼Œè¿”å›å“åº”ç»™è°ƒç”¨æ–¹çš„ç»“æ„ï¼Œè®¾ç½®è¿”å›å¤´

è¿”å›æ•°æ®ç»™è°ƒç”¨æ–¹ï¼Œä¸»è¦å°±æ˜¯åˆ©ç”¨è¿™ä¸ªä¸œè¥¿äº†ï¼Œå†…éƒ¨æä¾›çš„æ–¹æ³•ä¹Ÿä¸å°‘ï¼Œæˆ‘ä»¬ä¸»è¦å…³å¿ƒçš„å…¶å®ä¹Ÿå¹¶ä¸å¤ªå¤š

- è®¾ç½®è¿”å›å¤´ï¼š`javax.servlet.http.HttpServletResponse#setHeader`
- æ·»åŠ cookie: `javax.servlet.http.HttpServletResponse#addCookie`
- é‡å®šå‘ : `javax.servlet.http.HttpServletResponse#sendRedirect`
- å¼‚å¸¸ : `javax.servlet.http.HttpServletResponse#sendError`
- è®¾ç½®ContentType: `javax.servlet.ServletResponse#setContentType`
- è®¾ç½®è¿”å›æµ: `javax.servlet.ServletResponse#getOutputStream`,  `javax.servlet.ServletResponse#getWriter`
- è®¾ç½®ç¼–ç : `javax.servlet.ServletResponse#setCharacterEncoding`

## II. è¿›é˜¶

### 1. web.xmlä¸­é…ç½®
> è¿™ä¸ªé…ç½®ï¼Œä¸»è¦é’ˆå¯¹ Servlet çš„é¡ºåºæŒ‡å®šï¼ŒURLåŒ¹é…è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æœ‰å¿…è¦ç ”ç©¶ä¸‹è¿™ä¸ªé…ç½®ä¸­çš„è¯´æ˜

é€šå¸¸web.xmlçš„é…ç½®ï¼Œä¸‹é¢ä¸¤ä¸ªæ˜¯å¿…é¡»çš„

```xml
<!-- servletçš„é…ç½® -->
<servlet>
    <!-- servletçš„å†…éƒ¨åç§°ï¼Œè‡ªå®šä¹‰ã€‚å°½é‡æœ‰æ„ä¹‰ -->
    <servlet-name>ServletDemo</servlet-name>
    <!-- servletçš„ç±»å…¨åï¼š åŒ…å+ç®€å•ç±»å -->
    <servlet-class>com.xxx.ServletDemo</servlet-class>
</servlet>
<!-- servletçš„æ˜ å°„é…ç½® -->
<servlet-mapping>
    <!-- servletçš„å†…éƒ¨åç§°ï¼Œä¸€å®šè¦å’Œä¸Šé¢çš„å†…éƒ¨åç§°ä¿æŒä¸€è‡´ï¼ï¼ -->
    <servlet-name>ServletDemo</servlet-name>
    <!-- servletçš„æ˜ å°„è·¯å¾„ï¼ˆè®¿é—®servletçš„åç§°ï¼‰ -->
    <url-pattern>/servlet</url-pattern>
</servlet-mapping>
```

å…¶ä¸­ servlet-mapping æŒ‡å®šæ˜ å°„çš„è·¯å¾„ï¼Œæ»¡è¶³æ¡ä»¶çš„ä¼šåŒ¹é…å¯¹åº”çš„Servletï¼ŒåŒ¹é…è§„åˆ™æœ‰ä»¥ä¸‹å‡ ä¸ªå®šä¹‰

- å¿…é¡» / å¼€å¤´
- /servlet  è¡¨ç¤ºç²¾ç¡®åŒ¹é…
  - http://localhost:8088/servlet åŒ¹é…
  - http://localhost:8088/servlets ä¸åŒ¹é…
  - http://localhost:8088/servlet/123 ä¸åŒ¹é…
- /servlet/*  è¡¨ç¤ºç›®å½•åŒ¹é…ï¼Œæ‰€æœ‰servletè·¯å¾„å¼€å¤´çš„éƒ½å¯ä»¥åŒ¹é…
  - http://localhost:8088/servlet åŒ¹é…
  - http://localhost:8088/servlet/123 åŒ¹é…
  - http://localhost:8088/servlet/123/123 åŒ¹é…
  - http://localhost:8088/servlets ä¸åŒ¹é…
- /*.do  è¡¨ç¤ºæ‰©å±•ååŒ¹é…ï¼Œæ‰€æœ‰ä»¥ .do ç»“å°¾çš„åŒ¹é…


æ—¢ç„¶è¿™ä¸ªurlåŒ¹é…æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœä¸¤ä¸ªservletéƒ½åŒ¹é…äº†è¿™ä¸ªpathè·¯å¾„ï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯å“ªä¸ªå¤„ç†å‘¢ï¼Ÿ


æ³¨æ„åˆ°å‰é¢æœ‰ä¸ªé…ç½®å‚æ•°ï¼šload-on-startup

- å½“å€¼ä¸º0æˆ–è€…å¤§äº0æ—¶ï¼Œè¡¨ç¤ºå®¹å™¨åœ¨åº”ç”¨å¯åŠ¨æ—¶å°±åŠ è½½è¿™ä¸ªservletï¼›
- å½“æ˜¯ä¸€ä¸ªè´Ÿæ•°æ—¶æˆ–è€…æ²¡æœ‰æŒ‡å®šæ—¶ï¼Œåˆ™æŒ‡ç¤ºå®¹å™¨åœ¨è¯¥servletè¢«é€‰æ‹©æ—¶æ‰åŠ è½½
- æ­£æ•°çš„å€¼è¶Šå°ï¼Œå¯åŠ¨è¯¥servletçš„ä¼˜å…ˆçº§è¶Šé«˜

**æ³¨æ„** è¿™ä¸ªå‚æ•°æ˜¯åŠ è½½é¡ºåºï¼Œè€Œä¸æ˜¯æœ€ç»ˆçš„åŒ¹é…é¡ºåº

é‚£ä¹ˆåŒ¹é…é¡ºåºçš„ä¼˜å…ˆçº§æ˜¯ï¼š

- ç²¾ç¡®è·¯å¾„åŒ¹é…
  - æ¯”å¦‚servletA çš„url-patternä¸º /testï¼ŒservletBçš„url-patternä¸º /* ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæˆ‘è®¿é—®çš„urlä¸ºhttp://localhost/test ï¼Œè¿™ä¸ªæ—¶å€™å®¹å™¨å°±ä¼šå…ˆ è¿›è¡Œç²¾ç¡®è·¯å¾„åŒ¹é…ï¼Œå‘ç°/testæ­£å¥½è¢«servletAç²¾ç¡®åŒ¹é…ï¼Œé‚£ä¹ˆå°±å»è°ƒç”¨servletAï¼Œä¹Ÿä¸ä¼šå»ç†ä¼šå…¶ä»–çš„servletäº†
- æœ€é•¿è·¯å¾„åŒ¹é…
  - servletAçš„url-patternä¸º/test/*ï¼Œè€ŒservletBçš„url-patternä¸º/test/a/*ï¼Œæ­¤æ—¶è®¿é—®http://localhost/test/aæ—¶ï¼Œå®¹å™¨ä¼šé€‰æ‹©è·¯å¾„æœ€é•¿çš„servletæ¥åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„servletB
- æ‰©å±•åŒ¹é…ï¼Œå¦‚æœurlæœ€åä¸€æ®µåŒ…å«æ‰©å±•ï¼Œå®¹å™¨å°†ä¼šæ ¹æ®æ‰©å±•é€‰æ‹©åˆé€‚çš„servlet
- å¦‚æœå‰é¢ä¸‰æ¡è§„åˆ™éƒ½æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªservletï¼Œå®¹å™¨ä¼šæ ¹æ®urlé€‰æ‹©å¯¹åº”çš„è¯·æ±‚èµ„æºï¼Œå³åŒ¹é…defaultServlet


### 2. å‚æ•°è·å–
> å‚æ•°è·å–ï¼Œåˆ™ä¸»è¦åŒºåˆ†getè¯·æ±‚å‚æ•°ï¼Œpostæäº¤è¡¨å•ï¼Œä¸Šä¼ çš„æ–‡ä»¶äº†

#### a. é€šè¿‡ getQueryString

è¿™ç§è·å–å‚æ•°çš„æ–¹å¼ï¼Œåªèƒ½è·å–urlä¸Šé¢çš„å‚æ•°ï¼Œæ— æ³•è·å–åˆ°postçš„è¡¨å•å†…å®¹

```java
String str = req.getQueryString();
```

#### b. é€šè¿‡ getParameter

```java
// è¿”å›æ‰€æœ‰çš„è¯·æ±‚å‚æ•°
javax.servlet.ServletRequest#getParameterMap
```

è¿™ç§ä½¿ç”¨å§¿åŠ¿ï¼Œå’Œæˆ‘ä»¬åœ¨SpringMVCä¸­å¸¸è§çš„åŸºæœ¬ä¸€è‡´

#### c. é€šè¿‡ getInputStream

è·å–è¯·æ±‚æµï¼Œä¸€èˆ¬çš„ä½¿ç”¨å§¿åŠ¿å¦‚ä¸‹

```java
InputStream stream = req.getInputStream();
byte[] bytes = new byte[stream.available()];
stream.read(bytes);
String str = new String(bytes);
```

ç„¶åå°±éœ€è¦è‡ªå·±å¯¹ä¸Šé¢çš„è¯·æ±‚å‚æ•°è¿›è¡Œå¤„ç†äº†ï¼›ä¸¤å¢å¯¹æ¯”ï¼Œå¸¸è§„çš„è·å–æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨ getParameteræ–¹å¼æ›´åŠ ä¼˜é›…

**æ³¨æ„**

é€šè¿‡getInputStreamæ–¹å¼è·å–äº†è¯·æ±‚æ•°æ®ä¹‹åï¼Œå†é€šè¿‡ getParameterè·å–ä¸åˆ°å‚æ•°çš„ï¼Œä¹Ÿå¥½ç†è§£ï¼Œè¯·æ±‚çš„æµï¼Œè¢«ä½ è¯»å–ä¹‹åï¼Œå…¶ä»–çš„åœ°æ–¹å°±æ— æ³•è·å–æµä¸­çš„æ•°æ®äº†

#### d. è·å–ä¸Šä¼ çš„æ–‡ä»¶

ä»è¯·æ±‚å‚æ•°ä¸­è·å–ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç½‘ä¸Šéšæ„æœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°å¤§éƒ¨åˆ†éƒ½ä½¿ç”¨apacheçš„fileuploadåŒ…ï¼Œ å…¶å®å¤„ç†çš„ä¾ç„¶æ˜¯inputstreamè¿™ä¸ªè¯·æ±‚æµï¼Œåªæ˜¯é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œç²—ç•¥çš„ç¿»çœ‹äº†ä¸€ä¸‹æºç ï¼Œå‘ç°è¿™ä¸€å—è¿˜æŒºæœ‰æ„æ€çš„ï¼Œå‡†å¤‡å•ç‹¬çš„æ·±å…¥çœ‹ä¸€ä¸‹


### 3. æ•°æ®è¿”å›

è¿”å›æ•°æ®ï¼Œå‰é¢ä»‹ç»HttpServletResponseçš„æ—¶å€™ï¼Œå°±ç»™å‡ºäº†ä¸¤ä¸ªæ–¹æ³•

#### a. getWriter

```java
public PrintWriter getWriter() throws IOException;
```

#### b. getOutputStream

```java
public ServletOutputStream getOutputStream() throws IOException;
```

ä¸‹é¢ç®€å•è¯´ä¸€ä¸‹ä¸Šé¢çš„åŒºåˆ«

| PrintWriter | ServletOutputStream | 
| ---- | ---- |
| å­—ç¬¦æµè¿”å› | å­—èŠ‚æµè¿”å› |
| éœ€è¦å­—ç¬¦ç¼–ç  | å­—èŠ‚æµç›´æ¥è¿”å›ï¼ˆè¿”å›æ–‡ä»¶å°±å¾ˆå ä¼˜åŠ¿äº†ï¼‰ |


**è¯´æ˜**

1. ä¸Šé¢ä¸¤ç§æ–¹å¼äº’æ–¥ï¼Œåªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ç§case
2. Servletç¨‹åºå‘ServletOutputStreamæˆ–PrintWriterå¯¹è±¡ä¸­å†™å…¥çš„æ•°æ®å°†è¢«Servletå¼•æ“è·å–ï¼ŒServletå¼•æ“å°†è¿™äº›æ•°æ®å½“ä½œå“åº”æ¶ˆæ¯çš„æ­£æ–‡ï¼Œç„¶åå†ä¸å“åº”çŠ¶æ€è¡Œå’Œå„å“åº”å¤´ç»„åˆåè¾“å‡ºåˆ°å®¢æˆ·ç«¯
3. Serlvetçš„serviceæ–¹æ³•ç»“æŸåï¼ŒServletå¼•æ“å°†æ£€æŸ¥getWriteræˆ–getOutputStreamæ–¹æ³•è¿”å›çš„è¾“å‡ºæµå¯¹è±¡æ˜¯å¦å·²ç»è°ƒç”¨è¿‡closeæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰ï¼ŒServletå¼•æ“å°†è°ƒç”¨closeæ–¹æ³•å…³é—­è¯¥è¾“å‡ºæµå¯¹è±¡


### 4. è¿”å›å¤´è®¾ç½®

å¸¸è§çš„è¯·æ±‚å¤´å’Œè¿”å›å¤´è®¾ç½®ï¼Œå¯¹äºservletè€Œè¨€ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œä¸€èˆ¬å¸¸è§çš„å‡ ä¸ªè®¾ç½®

- æ˜¯å¦ç¼“å­˜ï¼Œç¼“å­˜æ—¶é—´
- è®¾ç½®cookie
- è®¾ç½® corss-origin ç›¸å…³ï¼Œä»¥æ”¯æŒè·¨åŸŸ
- è®¾ç½® content-type
...

è€Œå®é™…çš„ä½¿ç”¨ä¹Ÿæ¯”è¾ƒç®€å•äº†ï¼Œå¦‚ä¸‹å³å¯

```java
# javax.servlet.http.HttpServletResponse#addHeader
response.addHeader("Content-Type", "text/html; charset=UTF-8");
```

## III. å®ä¾‹æµ‹è¯•

åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å—¯Servletï¼Œç„¶åæ‹¦æˆªæ‰€æœ‰ /study ä¸‹é¢çš„è¯·æ±‚

```java
public class DocServlet extends HttpServlet {

    protected void doGet(HttpServletRequest req, HttpServletResponse resp)
            throws ServletException, IOException {
        resp.setCharacterEncoding("utf-8");
        PrintWriter writer = resp.getWriter();
        writer.append("è¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰servlet")
                .append("emojğŸ˜„==").flush();
        System.out.println("hereher!!!!");
    }

    protected void doPost(HttpServletRequest req, HttpServletResponse res) throws IOException {
        Map map = req.getParameterMap();
        System.out.println("arg: " + map);
        res.getWriter().append("success").flush();
    }
}
```

å¯¹åº”çš„xmlé…ç½®å¦‚ä¸‹

```xml
 <servlet>
    <servlet-name>doc-servlet</servlet-name>
    <servlet-class>com.yihui.study.DocServlet</servlet-class>
    <load-on-startup>2</load-on-startup>
</servlet>
<servlet-mapping>
    <servlet-name>doc-servlet</servlet-name>
    <url-pattern>/study/*</url-pattern>
</servlet-mapping>
```

å®æµ‹æ¼”ç¤ºï¼š

![show](https://s17.mogucdn.com/mlcdn/c45406/180123_2ebh689d410dj1j8d4dd1hh8bccih_1223x656.gif)


## IV. å…¶ä»–

### å‚è€ƒ

1. [servletè¯¦è§£(ç¬¬ä¸€ç¯‡)](http://blog.csdn.net/qq_28483283/article/details/51220749)

### å£°æ˜

å°½ä¿¡ä¹¦åˆ™ä¸å¦‚ï¼Œå·²ä¸Šå†…å®¹ï¼Œçº¯å±ä¸€å®¶ä¹‹è¨€ï¼Œå› æœ¬äººèƒ½åŠ›ä¸€èˆ¬ï¼Œè§è§£ä¸å…¨ï¼Œå¦‚æœ‰é—®é¢˜ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£

### æ‰«æå…³æ³¨ï¼Œjavaåˆ†äº«

![QrCode](https://s10.mogucdn.com/mlcdn/c45406/180103_61hi8f7kldkl202fked3k2g0ial1e_640x340.jpg)